{"version":3,"file":"miniedit.js","names":["MAX_UNDO_HISTORY","MiniEdit","el","options","_this","element","_setContent","pushHistory","onKeyDown","ev","keyCode","replaceSelection","preventDefault","setContent","setAttribute","addEventListener","reformat","_i2","_MiniEdit$plugins2","plugins","length","Plugin","_proto","prototype","traverseText","node","callback","nodeType","i","len","childNodes","setValue","text","selection","_this$pushHistory","undefined","getSelection","setSelection","call","getValue","textContent","endsWith","slice","oldContent","newText","start","end","sel","window","offset","rangeCount","range","getRangeAt","startContainer","startOffset","endContainer","endOffset","document","createRange","found","collapse","n","nextOffset","setStart","setEnd","removeAllRanges","addRange","select","MiniEditPastePlugin","editor","e","clipboardData","getData","push","MiniEditUndoPlugin","_this2","undoIndex","ignoreInput","history","onPushHistory","splice","shift","undoPressed","ctrlKey","metaKey","shiftKey","redoPressed","_this2$undoIndex","_this2$history$_this"],"sources":["../src/miniedit.ts"],"sourcesContent":["// MiniEdit: ContentEditable-based rich source editor\n\n// True WYSIWYG is really complex, and <textarea> is really limited, but if you\n// have a use-case which is approximately \"syntax highlighting\", you can achieve\n// that relatively easily.\n\n// On Google, the most common hack for syntax highlighting is to put an invisible\n// <textarea> on top of syntax highlighted text, but this only works if your\n// text is monospace and syntax highlighting doesn't change its metrics. This\n// approach is more flexible and only requires textContent to be preserved.\n\n// Inspired by https://github.com/SjonHortensius/LRTEditor\n// and https://codepen.io/brianmearns/pen/YVjZWw?editors=0010\n\nconst MAX_UNDO_HISTORY = 100;\nexport type MiniEditPlugin = new (editor: MiniEdit) => unknown;\nexport type MiniEditSelection = {start: number, end: number} | null;\nexport class MiniEdit {\n\tstatic plugins: MiniEditPlugin[] = [];\n\n\telement: HTMLElement;\n\n\t/**\n\t * Takes the plaintext `textContent` of the element, and renders it\n\t * in syntax-highlighted form. This must not change the resulting\n\t * `textContent`, because the data needs to flow two ways to\n\t * correctly respond to all the possible ways users can input text.\n\t *\n\t * It should, however, add a trailing `\\n` if the text doesn't end\n\t * with one. This is because HTML ignores trailing newlines, so if\n\t * it doesn't already exist and the user types a newline at the end\n\t * of the text, it wouldn't appear.\n\t */\n\t// tslint:disable-next-line\n\t_setContent: (text: string) => void;\n\tpushHistory?: (text: string, selection: MiniEditSelection) => void;\n\tonKeyDown = (ev: KeyboardEvent) => {\n\t\tif (ev.keyCode === 13) { // enter\n\t\t\tthis.replaceSelection('\\n');\n\t\t\tev.preventDefault();\n\t\t}\n\t};\n\n\tconstructor(el: HTMLElement, options: {setContent: MiniEdit['_setContent'], onKeyDown?: (ev: KeyboardEvent) => void}) {\n\t\tthis.element = el;\n\n\t\tthis._setContent = options.setContent;\n\t\tthis.onKeyDown = options.onKeyDown || this.onKeyDown;\n\n\t\tthis.element.setAttribute('contentEditable', 'true');\n\t\tthis.element.setAttribute('autoComplete', 'off');\n\t\tthis.element.setAttribute('spellCheck', 'false');\n\t\tthis.element.addEventListener('input', () => {\n\t\t\tthis.reformat();\n\t\t});\n\t\tthis.element.addEventListener('keydown', this.onKeyDown);\n\n\t\t// tslint:disable-next-line\n\t\tfor (const Plugin of MiniEdit.plugins) new Plugin(this);\n\t}\n\n\t/** return true from callback for an early return */\n\tprivate traverseText(node: Node, callback: (node: Text) => boolean): boolean {\n\t\tif (node.nodeType === 3) {\n\t\t\tif (callback(node as Text)) return true;\n\t\t} else {\n\t\t\tfor (let i = 0, len = node.childNodes.length; i < len; ++i) {\n\t\t\t\tif (this.traverseText(node.childNodes[i], callback)) return true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tsetValue(text: string, selection?: MiniEditSelection): void {\n\t\tif (selection === undefined) selection = this.getSelection();\n\t\tthis._setContent(text);\n\n\t\tthis.setSelection(selection);\n\t\tthis.pushHistory?.(text, selection);\n\t}\n\tgetValue(): string {\n\t\tlet text = this.element.textContent || '';\n\t\tif (text.endsWith('\\n')) return text.slice(0, -1);\n\t\treturn text;\n\t}\n\treformat(selection?: MiniEditSelection): void {\n\t\tthis.setValue(this.getValue(), selection);\n\t}\n\treplaceSelection(text: string): void {\n\t\tconst selection = this.getSelection()!;\n\t\tconst oldContent = this.getValue();\n\t\tconst newText = oldContent.slice(0, selection.start) + text + oldContent.slice(selection.end);\n\t\tthis.setValue(newText, {start: selection.start + text.length, end: selection.start + text.length});\n\t}\n\n\tgetSelection(): MiniEditSelection {\n\t\tconst sel = window.getSelection()!;\n\t\tlet offset = 0;\n\t\tlet start = null as number | null;\n\t\tlet end = null as number | null;\n\n\t\tif (sel.rangeCount) {\n\t\t\tconst range = sel.getRangeAt(0);\n\t\t\tthis.traverseText(this.element, node => {\n\t\t\t\tif (start === null && node === range.startContainer) {\n\t\t\t\t\tstart = offset + range.startOffset;\n\t\t\t\t}\n\n\t\t\t\tif (start !== null && node === range.endContainer) {\n\t\t\t\t\tend = offset + range.endOffset;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\toffset += node.length;\n\t\t\t\treturn false;\n\t\t\t});\n\t\t}\n\n\t\treturn (start === null || end === null) ? null : {start, end};\n\t}\n\n\tsetSelection(sel: MiniEditSelection): void {\n\t\tif (sel === null) return;\n\n\t\tconst range = document.createRange();\n\t\tlet offset = 0;\n\t\tlet found = false;\n\t\trange.collapse(true);\n\n\t\tif (this.traverseText(this.element, n => {\n\t\t\tconst nextOffset = offset + n.length;\n\n\t\t\tif (!found && sel.start >= offset && sel.start <= nextOffset) {\n\t\t\t\trange.setStart(n, sel.start - offset);\n\t\t\t\tfound = true;\n\t\t\t}\n\n\t\t\tif (found && sel.end >= offset && sel.end <= nextOffset) {\n\t\t\t\trange.setEnd(n, sel.end - offset);\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\toffset = nextOffset;\n\t\t\treturn false;\n\t\t})) {\n\t\t\tconst selection = window.getSelection()!;\n\t\t\tselection.removeAllRanges();\n\t\t\tselection.addRange(range);\n\t\t}\n\t}\n\tselect(): void {\n\t\tthis.setSelection({start: 0, end: this.getValue().length});\n\t}\n}\n\nexport class MiniEditPastePlugin {\n\tconstructor(editor: MiniEdit) {\n\t\teditor.element.addEventListener('paste', e => {\n\t\t\t// Manually insert plain-text contents so we keep newlines\n\t\t\tconst text = e.clipboardData!.getData('text/plain');\n\t\t\teditor.replaceSelection(text);\n\t\t\te.preventDefault();\n\t\t});\n\t}\n}\nMiniEdit.plugins.push(MiniEditPastePlugin);\n\n// We can't use the native undo/redo feature because browsers just get so\n// confused by our syntax highlighting, so we have to reimplement it.\n// We can intercept ctrl+z and ctrl+y, but we can't intercept the browser's\n// UI so things like Edit -> Undo will simply not work. I am sorry to say\n// that there is no solution and this is just what webdev is like.\nexport class MiniEditUndoPlugin {\n\teditor: MiniEdit;\n\tundoIndex: number | null = null;\n\tignoreInput = false;\n\thistory: {text: string, selection: MiniEditSelection}[] = [];\n\n\tconstructor(editor: MiniEdit) {\n\t\tthis.editor = editor;\n\t\tthis.history.push({text: editor.getValue(), selection: {start: 0, end: 0}});\n\n\t\tthis.editor.pushHistory = this.onPushHistory;\n\t\teditor.element.addEventListener('keydown', this.onKeyDown);\n\t}\n\n\tonPushHistory = (text: string, selection: MiniEditSelection) => {\n\t\tif (this.ignoreInput) {\n\t\t\t// This change was triggered by undo/redo, don't record it\n\t\t\tthis.ignoreInput = false;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.undoIndex !== null) {\n\t\t\t// chop off everything after the current undo index\n\t\t\tthis.history.splice(this.undoIndex + 1);\n\t\t\tthis.undoIndex = null;\n\t\t}\n\n\t\tthis.history.push({text, selection});\n\n\t\tif (this.history.length > MAX_UNDO_HISTORY) this.history.shift();\n\t};\n\n\tonKeyDown = (e: KeyboardEvent) => {\n\t\t// ctrl+z or cmd+z\n\t\tconst undoPressed = (e.ctrlKey && e.keyCode === 90) || (e.metaKey && !e.shiftKey && e.keyCode === 90);\n\t\t// ctrl+y or cmd+shift+z\n\t\tconst redoPressed = (e.ctrlKey && e.keyCode === 89) || (e.metaKey && e.shiftKey && e.keyCode === 90);\n\n\t\tif (undoPressed) {\n\t\t\tthis.undoIndex ??= this.history.length - 1;\n\t\t\tthis.undoIndex--;\n\n\t\t\tif (this.undoIndex < 0) { // can't undo further\n\t\t\t\tthis.undoIndex = 0;\n\t\t\t\treturn;\n\t\t\t}\n\t\t} else if (redoPressed && this.undoIndex !== null) {\n\t\t\tthis.undoIndex++;\n\n\t\t\tif (this.undoIndex > this.history.length - 1) { // can't redo further\n\t\t\t\tthis.undoIndex = null;\n\t\t\t\treturn;\n\t\t\t}\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\tconst {text, selection} = this.history[this.undoIndex];\n\t\tthis.ignoreInput = true;\n\t\tthis.editor.setValue(text, selection);\n\t};\n}\nMiniEdit.plugins.push(MiniEditUndoPlugin);\n"],"mappings":"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"}
{"version":3,"file":"panel-chat.js","names":["ChatRoom","_PSRoom","_inheritsLoose","options","_this","call","classType","users","userCount","canConnect","pmTarget","challengeMenuOpen","challengingFormat","challengedFormat","updateTarget","connect","_proto","prototype","connected","PS","send","id","connectWhenLoggedIn","force","startsWith","_this$id$slice$split","slice","split","id1","id2","user","userid","toID","setUsers","title","handleMessage","line","spaceIndex","indexOf","cmd","target","roomid","test","join","leave","openChallenge","cancelChallenge","update","receiveLine","direct","count","usernames","_i2","length","username","addUser","removeUser","noUpdate","renameUser","oldUsername","destroy","PSRoom","ChatTextEntry","_preact$Component","_this2","_len","arguments","args","Array","_key","apply","concat","subscription","textbox","miniedit","history","historyIndex","focusIfNoSelection","e","tagName","selection","window","getSelection","type","elem","base","children","focus","onKeyDown","handleKey","props","onKey","preventDefault","stopImmediatePropagation","_proto2","componentDidMount","_this3","subscribe","forceUpdate","MiniEdit","setContent","text","innerHTML","formatText","componentWillUnmount","unsubscribe","submit","onMessage","getValue","historyPush","setValue","value","_this$textbox$setSele","_this$textbox","setSelectionRange","start","end","historyUp","historyDown","duplicateIndex","lastIndexOf","splice","push","ev","cmdKey","metaKey","ctrlKey","altKey","shiftKey","anyModifier","keyCode","replaceSelection","toggleFormatChar","selectionStart","selectionEnd","setSelection","_this$textbox$setSele2","_this$textbox2","formatChar","_this$getSelection","charAt","wrap","substr","nesting","render","OLD_TEXTBOX","preact","h","onClick","style","left","color","BattleLog","usernameColor","name","room","autofocus","rows","onInput","resize","width","height","padding","placeholder","focusPreview","ChatTextBox","Component","_preact$Component2","_proto3","shouldComponentUpdate","ChatPanel","_PSRoomPanel","_this4","_len2","_key2","chatLog","getElementsByClassName","scrollTop","offsetHeight","makeChallenge","format","team","packedTeam","Error","acceptChallenge","_proto4","_this5","setTimeout","querySelector","tinyLayout","challengeTo","TeamForm","onSubmit","challengeFrom","PSPanelWrapper","ChatLog","ChatUserList","minimized","PSRoomPanel","_preact$Component3","_this6","_len3","_key3","state","expanded","toggleExpanded","setState","_proto5","_this7","msg","userList","Object","entries","PSUtils","sortBy","_ref","server","getGroup","order","endsWith","map","_ref2","groupSymbol","group","groups","key","includes","_preact$Component4","_this8","_len4","_key4","log","_proto6","_this9","noSubscription","tokens","parseInt","shift","add","setControlsJSX","className","top","updateScroll","jsx","controlsElem","undefined","document","createElement","appendChild","battle","scene","role","roomTypes","Model","updateRoomTypes"],"sources":["../src/panel-chat.tsx"],"sourcesContent":["/**\n * Chat panel\n *\n * @author Guangcong Luo <guangcongluo@gmail.com>\n * @license AGPLv3\n */\n\ndeclare const MiniEdit: typeof import('./miniedit').MiniEdit;\ntype MiniEdit = import('./miniedit').MiniEdit;\ndeclare const formatText: any;\n\nclass ChatRoom extends PSRoom {\n\treadonly classType: 'chat' | 'battle' = 'chat';\n\tusers: {[userid: string]: string} = {};\n\tuserCount = 0;\n\treadonly canConnect = true;\n\n\t// PM-only properties\n\tpmTarget: string | null = null;\n\tchallengeMenuOpen = false;\n\tchallengingFormat: string | null = null;\n\tchallengedFormat: string | null = null;\n\n\tconstructor(options: RoomOptions) {\n\t\tsuper(options);\n\t\tif (options.pmTarget) this.pmTarget = options.pmTarget as string;\n\t\tif (options.challengeMenuOpen) this.challengeMenuOpen = true;\n\t\tthis.updateTarget(true);\n\t\tthis.connect();\n\t}\n\tconnect() {\n\t\tif (!this.connected) {\n\t\t\tif (!this.pmTarget) PS.send(`|/join ${this.id}`);\n\t\t\tthis.connected = true;\n\t\t\tthis.connectWhenLoggedIn = false;\n\t\t}\n\t}\n\tupdateTarget(force?: boolean) {\n\t\tif (this.id.startsWith('pm-')) {\n\t\t\tconst [id1, id2] = this.id.slice(3).split('-');\n\t\t\tif (id1 === PS.user.userid && toID(this.pmTarget) !== id2) {\n\t\t\t\tthis.pmTarget = id2;\n\t\t\t} else if (id2 === PS.user.userid && toID(this.pmTarget) !== id1) {\n\t\t\t\tthis.pmTarget = id1;\n\t\t\t} else if (!force) {\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tthis.pmTarget = id1;\n\t\t\t}\n\t\t\tif (!this.userCount) {\n\t\t\t\tthis.setUsers(2, [` ${id1}`, ` ${id2}`]);\n\t\t\t}\n\t\t\tthis.title = `[PM] ${this.pmTarget}`;\n\t\t}\n\t}\n\t/**\n\t * @return true to prevent line from being sent to server\n\t */\n\thandleMessage(line: string) {\n\t\tif (!line.startsWith('/') || line.startsWith('//')) return false;\n\t\tconst spaceIndex = line.indexOf(' ');\n\t\tconst cmd = spaceIndex >= 0 ? line.slice(1, spaceIndex) : line.slice(1);\n\t\tconst target = spaceIndex >= 0 ? line.slice(spaceIndex + 1) : '';\n\t\tswitch (cmd) {\n\t\tcase 'j': case 'join': {\n\t\t\tconst roomid = /[^a-z0-9-]/.test(target) ? toID(target) as any as RoomID : target as RoomID;\n\t\t\tPS.join(roomid);\n\t\t\treturn true;\n\t\t} case 'part': case 'leave': {\n\t\t\tconst roomid = /[^a-z0-9-]/.test(target) ? toID(target) as any as RoomID : target as RoomID;\n\t\t\tPS.leave(roomid || this.id);\n\t\t\treturn true;\n\t\t} case 'chall': case 'challenge': {\n\t\t\tif (target) {\n\t\t\t\tPS.join(`challenge-${toID(target)}` as RoomID);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tthis.openChallenge();\n\t\t\treturn true;\n\t\t} case 'cchall': case 'cancelchallenge': {\n\t\t\tthis.cancelChallenge();\n\t\t\treturn true;\n\t\t} case 'reject': {\n\t\t\tthis.challengedFormat = null;\n\t\t\tthis.update(null);\n\t\t\treturn false;\n\t\t}}\n\t\treturn super.handleMessage(line);\n\t}\n\topenChallenge() {\n\t\tif (!this.pmTarget) {\n\t\t\tthis.receiveLine([`error`, `Can only be used in a PM.`]);\n\t\t\treturn;\n\t\t}\n\t\tthis.challengeMenuOpen = true;\n\t\tthis.update(null);\n\t}\n\tcancelChallenge() {\n\t\tif (!this.pmTarget) {\n\t\t\tthis.receiveLine([`error`, `Can only be used in a PM.`]);\n\t\t\treturn;\n\t\t}\n\t\tif (this.challengingFormat) {\n\t\t\tthis.send('/cancelchallenge', true);\n\t\t\tthis.challengingFormat = null;\n\t\t\tthis.challengeMenuOpen = true;\n\t\t} else {\n\t\t\tthis.challengeMenuOpen = false;\n\t\t}\n\t\tthis.update(null);\n\t}\n\tsend(line: string, direct?: boolean) {\n\t\tthis.updateTarget();\n\t\tif (!direct && !line) return;\n\t\tif (!direct && this.handleMessage(line)) return;\n\t\tif (this.pmTarget) {\n\t\t\tPS.send(`|/pm ${this.pmTarget}, ${line}`);\n\t\t\treturn;\n\t\t}\n\t\tsuper.send(line, true);\n\t}\n\tsetUsers(count: number, usernames: string[]) {\n\t\tthis.userCount = count;\n\t\tthis.users = {};\n\t\tfor (const username of usernames) {\n\t\t\tconst userid = toID(username);\n\t\t\tthis.users[userid] = username;\n\t\t}\n\t\tthis.update(null);\n\t}\n\taddUser(username: string) {\n\t\tconst userid = toID(username);\n\t\tif (!(userid in this.users)) this.userCount++;\n\t\tthis.users[userid] = username;\n\t\tthis.update(null);\n\t}\n\tremoveUser(username: string, noUpdate?: boolean) {\n\t\tconst userid = toID(username);\n\t\tif (userid in this.users) {\n\t\t\tthis.userCount--;\n\t\t\tdelete this.users[userid];\n\t\t}\n\t\tif (!noUpdate) this.update(null);\n\t}\n\trenameUser(username: string, oldUsername: string) {\n\t\tthis.removeUser(oldUsername, true);\n\t\tthis.addUser(username);\n\t\tthis.update(null);\n\t}\n\tdestroy() {\n\t\tif (this.pmTarget) this.connected = false;\n\t\tsuper.destroy();\n\t}\n}\n\nclass ChatTextEntry extends preact.Component<{\n\troom: PSRoom, onMessage: (msg: string) => void, onKey: (e: KeyboardEvent) => boolean,\n\tleft?: number,\n}> {\n\tsubscription: PSSubscription | null = null;\n\ttextbox: HTMLTextAreaElement = null!;\n\tminiedit: MiniEdit | null = null;\n\thistory: string[] = [];\n\thistoryIndex = 0;\n\toverride componentDidMount() {\n\t\tthis.subscription = PS.user.subscribe(() => {\n\t\t\tthis.forceUpdate();\n\t\t});\n\t\tconst textbox = this.base!.children[0].children[1] as HTMLElement;\n\t\tif (textbox.tagName === 'TEXTAREA') this.textbox = textbox as HTMLTextAreaElement;\n\t\tthis.miniedit = new MiniEdit(textbox, {\n\t\t\tsetContent: text => {\n\t\t\t\ttextbox.innerHTML = formatText(text, false, false, true) + '\\n';\n\t\t\t},\n\t\t\tonKeyDown: this.onKeyDown,\n\t\t});\n\t\tif (this.base) this.update();\n\t}\n\toverride componentWillUnmount() {\n\t\tif (this.subscription) {\n\t\t\tthis.subscription.unsubscribe();\n\t\t\tthis.subscription = null;\n\t\t}\n\t}\n\tupdate = () => {\n\t\t// const textbox = this.textbox;\n\t\t// textbox.style.height = `12px`;\n\t\t// const newHeight = Math.min(Math.max(textbox.scrollHeight - 2, 16), 600);\n\t\t// textbox.style.height = `${newHeight}px`;\n\t};\n\tfocusIfNoSelection = (e: Event) => {\n\t\tif ((e.target as HTMLElement).tagName === 'TEXTAREA') return;\n\t\tconst selection = window.getSelection()!;\n\t\tif (selection.type === 'Range') return;\n\t\tconst elem = this.base!.children[0].children[1] as HTMLTextAreaElement;\n\t\telem.focus();\n\t};\n\tsubmit() {\n\t\tthis.props.onMessage(this.getValue());\n\t\tthis.historyPush(this.getValue());\n\t\tthis.setValue('');\n\t\tthis.update();\n\t\treturn true;\n\t}\n\tonKeyDown = (e: KeyboardEvent) => {\n\t\tif (this.handleKey(e) || this.props.onKey(e)) {\n\t\t\te.preventDefault();\n\t\t\te.stopImmediatePropagation();\n\t\t}\n\t};\n\tgetValue() {\n\t\treturn this.miniedit ? this.miniedit.getValue() : this.textbox.value;\n\t}\n\tsetValue(value: string, selection?: {start: number, end: number}) {\n\t\tif (this.miniedit) {\n\t\t\tthis.miniedit.setValue(value, selection);\n\t\t} else {\n\t\t\tthis.textbox.value = value;\n\t\t\tif (selection) this.textbox.setSelectionRange?.(selection.start, selection.end);\n\t\t}\n\t}\n\thistoryUp() {\n\t\tif (this.historyIndex === 0) return false;\n\t\tconst line = this.getValue();\n\t\tif (line !== '') this.history[this.historyIndex] = line;\n\t\tthis.setValue(this.history[--this.historyIndex]);\n\t\treturn true;\n\t}\n\thistoryDown() {\n\t\tconst line = this.getValue();\n\t\tif (line !== '') this.history[this.historyIndex] = line;\n\t\tif (this.historyIndex === this.history.length) {\n\t\t\tif (!line) return false;\n\t\t\tthis.setValue('');\n\t\t} else if (++this.historyIndex === this.history.length) {\n\t\t\tthis.setValue('');\n\t\t} else {\n\t\t\tthis.setValue(this.history[this.historyIndex]);\n\t\t}\n\t\treturn true;\n\t}\n\thistoryPush(line: string) {\n\t\tconst duplicateIndex = this.history.lastIndexOf(line);\n\t\tif (duplicateIndex >= 0) this.history.splice(duplicateIndex, 1);\n\t\tif (this.history.length > 100) this.history.splice(0, 20);\n\t\tthis.history.push(line);\n\t\tthis.historyIndex = this.history.length;\n\t}\n\thandleKey(ev: KeyboardEvent) {\n\t\tconst cmdKey = ((ev.metaKey ? 1 : 0) + (ev.ctrlKey ? 1 : 0) === 1) && !ev.altKey && !ev.shiftKey;\n\t\tconst anyModifier = ev.ctrlKey || ev.altKey || ev.metaKey || ev.shiftKey;\n\t\tif (ev.keyCode === 13 && !ev.shiftKey) { // Enter key\n\t\t\treturn this.submit();\n\t\t} else if (ev.keyCode === 13 && this.miniedit) { // enter\n\t\t\tthis.miniedit.replaceSelection('\\n');\n\t\t\treturn true;\n\t\t} else if (ev.keyCode === 73 && cmdKey) { // Ctrl + I key\n\t\t\treturn this.toggleFormatChar('_');\n\t\t} else if (ev.keyCode === 66 && cmdKey) { // Ctrl + B key\n\t\t\treturn this.toggleFormatChar('*');\n\t\t} else if (ev.keyCode === 192 && cmdKey) { // Ctrl + ` key\n\t\t\treturn this.toggleFormatChar('`');\n\t\t// } else if (e.keyCode === 9 && !e.ctrlKey) { // Tab key\n\t\t// \tconst reverse = !!e.shiftKey; // Shift+Tab reverses direction\n\t\t// \treturn this.handleTabComplete(this.$chatbox, reverse);\n\t\t} else if (ev.keyCode === 38 && !ev.shiftKey && !ev.altKey) { // Up key\n\t\t\treturn this.historyUp();\n\t\t} else if (ev.keyCode === 40 && !ev.shiftKey && !ev.altKey) { // Down key\n\t\t\treturn this.historyDown();\n\t\t// } else if (app.user.lastPM && (textbox.value === '/reply' || textbox.value === '/r' || textbox.value === '/R') && e.keyCode === 32) { // '/reply ' is being written\n\t\t// \tvar val = '/pm ' + app.user.lastPM + ', ';\n\t\t// \ttextbox.value = val;\n\t\t// \ttextbox.setSelectionRange(val.length, val.length);\n\t\t// \treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\tgetSelection() {\n\t\treturn this.miniedit ?\n\t\t\t(this.miniedit.getSelection() || {start: 0, end: 0}) :\n\t\t\t{start: this.textbox.selectionStart, end: this.textbox.selectionEnd};\n\t}\n\tsetSelection(start: number, end: number) {\n\t\tif (this.miniedit) {\n\t\t\tthis.miniedit.setSelection({start, end});\n\t\t} else {\n\t\t\tthis.textbox.setSelectionRange?.(start, end);\n\t\t}\n\t}\n\ttoggleFormatChar(formatChar: string) {\n\t\tlet value = this.getValue();\n\t\tlet {start, end} = this.getSelection();\n\n\t\t// make sure start and end aren't midway through the syntax\n\t\tif (value.charAt(start) === formatChar && value.charAt(start - 1) === formatChar &&\n\t\t\tvalue.charAt(start - 2) !== formatChar) {\n\t\t\tstart++;\n\t\t}\n\t\tif (value.charAt(end) === formatChar && value.charAt(end - 1) === formatChar &&\n\t\t\tvalue.charAt(end - 2) !== formatChar) {\n\t\t\tend--;\n\t\t}\n\n\t\t// wrap in doubled format char\n\t\tconst wrap = formatChar + formatChar;\n\t\tvalue = value.substr(0, start) + wrap + value.substr(start, end - start) + wrap + value.substr(end);\n\t\tstart += 2;\n\t\tend += 2;\n\n\t\t// prevent nesting\n\t\tconst nesting = wrap + wrap;\n\t\tif (value.substr(start - 4, 4) === nesting) {\n\t\t\tvalue = value.substr(0, start - 4) + value.substr(start);\n\t\t\tstart -= 4;\n\t\t\tend -= 4;\n\t\t} else if (start !== end && value.substr(start - 2, 4) === nesting) {\n\t\t\tvalue = value.substr(0, start - 2) + value.substr(start + 2);\n\t\t\tstart -= 2;\n\t\t\tend -= 4;\n\t\t}\n\t\tif (value.substr(end, 4) === nesting) {\n\t\t\tvalue = value.substr(0, end) + value.substr(end + 4);\n\t\t} else if (start !== end && value.substr(end - 2, 4) === nesting) {\n\t\t\tvalue = value.substr(0, end - 2) + value.substr(end + 2);\n\t\t\tend -= 2;\n\t\t}\n\n\t\tthis.setValue(value, {start, end});\n\t\treturn true;\n\t}\n\toverride render() {\n\t\tconst OLD_TEXTBOX = false;\n\t\treturn <div\n\t\t\tclass=\"chat-log-add hasuserlist\" onClick={this.focusIfNoSelection} style={{left: this.props.left || 0}}\n\t\t>\n\t\t\t<form class=\"chatbox\">\n\t\t\t\t<label style={{color: BattleLog.usernameColor(PS.user.userid)}}>{PS.user.name}:</label>\n\t\t\t\t{OLD_TEXTBOX ? <textarea\n\t\t\t\t\tclass={this.props.room.connected ? 'textbox' : 'textbox disabled'}\n\t\t\t\t\tautofocus\n\t\t\t\t\trows={1}\n\t\t\t\t\tonInput={this.update}\n\t\t\t\t\tonKeyDown={this.onKeyDown}\n\t\t\t\t\tstyle={{resize: 'none', width: '100%', height: '16px', padding: '2px 3px 1px 3px'}}\n\t\t\t\t\tplaceholder={PS.focusPreview(this.props.room)}\n\t\t\t\t/> : <ChatTextBox\n\t\t\t\t\tclass={this.props.room.connected ? 'textbox' : 'textbox disabled'}\n\t\t\t\t\tplaceholder={PS.focusPreview(this.props.room)}\n\t\t\t\t/>}\n\t\t\t</form>\n\t\t</div>;\n\t}\n}\n\nclass ChatTextBox extends preact.Component<{placeholder: string, class: string}> {\n\toverride shouldComponentUpdate() {\n\t\treturn false;\n\t}\n\toverride render() {\n\t\treturn <pre class={this.props.class} placeholder={this.props.placeholder}>{'\\n'}</pre>;\n\t}\n}\n\nclass ChatPanel extends PSRoomPanel<ChatRoom> {\n\tsend = (text: string) => {\n\t\tthis.props.room.send(text);\n\t};\n\tfocus() {\n\t\t// Called synchronously after a forceUpdate, so before the DOM has\n\t\t// been updated to make the panel visible. The order isn't\n\t\t// important for textboxes, which can be focused while inside a\n\t\t// `display: none` element, but contentEditable boxes are pickier.\n\t\t// Waiting for a 0 timeout turns out to be enough.\n\t\tsetTimeout(() => {\n\t\t\t(this.base!.querySelector('textarea, pre.textbox') as HTMLElement).focus();\n\t\t}, 0);\n\t}\n\tfocusIfNoSelection = () => {\n\t\tconst selection = window.getSelection()!;\n\t\tif (selection.type === 'Range') return;\n\t\tthis.focus();\n\t};\n\tonKey = (e: KeyboardEvent) => {\n\t\tif (e.keyCode === 33) { // Pg Up key\n\t\t\tconst chatLog = this.base!.getElementsByClassName('chat-log')[0] as HTMLDivElement;\n\t\t\tchatLog.scrollTop = chatLog.scrollTop - chatLog.offsetHeight + 60;\n\t\t\treturn true;\n\t\t} else if (e.keyCode === 34) { // Pg Dn key\n\t\t\tconst chatLog = this.base!.getElementsByClassName('chat-log')[0] as HTMLDivElement;\n\t\t\tchatLog.scrollTop = chatLog.scrollTop + chatLog.offsetHeight - 60;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t};\n\tmakeChallenge = (e: Event, format: string, team?: Team) => {\n\t\tconst room = this.props.room;\n\t\tconst packedTeam = team ? team.packedTeam : '';\n\t\tif (!room.pmTarget) throw new Error(\"Not a PM room\");\n\t\tPS.send(`|/utm ${packedTeam}`);\n\t\tPS.send(`|/challenge ${room.pmTarget}, ${format}`);\n\t\troom.challengeMenuOpen = false;\n\t\troom.challengingFormat = format;\n\t\troom.update(null);\n\t};\n\tacceptChallenge = (e: Event, format: string, team?: Team) => {\n\t\tconst room = this.props.room;\n\t\tconst packedTeam = team ? team.packedTeam : '';\n\t\tif (!room.pmTarget) throw new Error(\"Not a PM room\");\n\t\tPS.send(`|/utm ${packedTeam}`);\n\t\tthis.props.room.send(`/accept`);\n\t\troom.challengedFormat = null;\n\t\troom.update(null);\n\t};\n\trender() {\n\t\tconst room = this.props.room;\n\t\tconst tinyLayout = room.width < 450;\n\n\t\tconst challengeTo = room.challengingFormat ? <div class=\"challenge\">\n\t\t\t<TeamForm format={room.challengingFormat} onSubmit={null}>\n\t\t\t\t<button name=\"cmd\" value=\"/cancelchallenge\" class=\"button\">Cancel</button>\n\t\t\t</TeamForm>\n\t\t</div> : room.challengeMenuOpen ? <div class=\"challenge\">\n\t\t\t<TeamForm onSubmit={this.makeChallenge}>\n\t\t\t\t<button type=\"submit\" class=\"button\"><strong>Challenge</strong></button> {}\n\t\t\t\t<button name=\"cmd\" value=\"/cancelchallenge\" class=\"button\">Cancel</button>\n\t\t\t</TeamForm>\n\t\t</div> : null;\n\n\t\tconst challengeFrom = room.challengedFormat ? <div class=\"challenge\">\n\t\t\t<TeamForm format={room.challengedFormat} onSubmit={this.acceptChallenge}>\n\t\t\t\t<button type=\"submit\" class=\"button\"><strong>Accept</strong></button> {}\n\t\t\t\t<button name=\"cmd\" value=\"/reject\" class=\"button\">Reject</button>\n\t\t\t</TeamForm>\n\t\t</div> : null;\n\n\t\treturn <PSPanelWrapper room={room}>\n\t\t\t<div class=\"tournament-wrapper hasuserlist\"></div>\n\t\t\t<ChatLog class=\"chat-log\" room={this.props.room} onClick={this.focusIfNoSelection} left={tinyLayout ? 0 : 146}>\n\t\t\t\t{challengeTo || challengeFrom && [challengeTo, challengeFrom]}\n\t\t\t</ChatLog>\n\t\t\t<ChatTextEntry room={this.props.room} onMessage={this.send} onKey={this.onKey} left={tinyLayout ? 0 : 146} />\n\t\t\t<ChatUserList room={this.props.room} minimized={tinyLayout} />\n\t\t</PSPanelWrapper>;\n\t}\n}\n\nclass ChatUserList extends preact.Component<{room: ChatRoom, left?: number, minimized?: boolean}> {\n\tsubscription: PSSubscription | null = null;\n\tstate = {\n\t\texpanded: false,\n\t};\n\ttoggleExpanded = () => {\n\t\tthis.setState({expanded: !this.state.expanded});\n\t};\n\tcomponentDidMount() {\n\t\tthis.subscription = this.props.room.subscribe(msg => {\n\t\t\tif (!msg) this.forceUpdate();\n\t\t});\n\t}\n\tcomponentWillUnmount() {\n\t\tif (this.subscription) this.subscription.unsubscribe();\n\t}\n\trender() {\n\t\tconst room = this.props.room;\n\t\tlet userList = Object.entries(room.users) as [ID, string][];\n\t\tPSUtils.sortBy(userList, ([id, name]) => (\n\t\t\t[PS.server.getGroup(name.charAt(0)).order, !name.endsWith('@!'), id]\n\t\t));\n\t\treturn <ul class={'userlist' + (this.props.minimized ? (this.state.expanded ? ' userlist-maximized' : ' userlist-minimized') : '')} style={{left: this.props.left || 0}}>\n\t\t\t<li class=\"userlist-count\" onClick={this.toggleExpanded}><small>{room.userCount} users</small></li>\n\t\t\t{userList.map(([userid, name]) => {\n\t\t\t\tconst groupSymbol = name.charAt(0);\n\t\t\t\tconst group = PS.server.groups[groupSymbol] || {type: 'user', order: 0};\n\t\t\t\tlet color;\n\t\t\t\tif (name.endsWith('@!')) {\n\t\t\t\t\tname = name.slice(0, -2);\n\t\t\t\t\tcolor = '#888888';\n\t\t\t\t} else {\n\t\t\t\t\tcolor = BattleLog.usernameColor(userid);\n\t\t\t\t}\n\t\t\t\treturn <li key={userid}><button class=\"userbutton username\" data-name={name}>\n\t\t\t\t\t<em class={`group${['leadership', 'staff'].includes(group.type!) ? ' staffgroup' : ''}`}>\n\t\t\t\t\t\t{groupSymbol}\n\t\t\t\t\t</em>\n\t\t\t\t\t{group.type === 'leadership' ?\n\t\t\t\t\t\t<strong><em style={{color}}>{name.substr(1)}</em></strong>\n\t\t\t\t\t: group.type === 'staff' ?\n\t\t\t\t\t\t<strong style={{color}}>{name.substr(1)}</strong>\n\t\t\t\t\t:\n\t\t\t\t\t\t<span style={{color}}>{name.substr(1)}</span>\n\t\t\t\t\t}\n\t\t\t\t</button></li>;\n\t\t\t})}\n\t\t</ul>;\n\t}\n}\n\nclass ChatLog extends preact.Component<{\n\tclass: string, room: ChatRoom, onClick?: (e: Event) => void, children?: preact.ComponentChildren,\n\tleft?: number, top?: number, noSubscription?: boolean;\n}> {\n\tlog: BattleLog | null = null;\n\tsubscription: PSSubscription | null = null;\n\tcomponentDidMount() {\n\t\tif (!this.props.noSubscription) {\n\t\t\tthis.log = new BattleLog(this.base! as HTMLDivElement);\n\t\t}\n\t\tthis.subscription = this.props.room.subscribe(tokens => {\n\t\t\tif (!tokens) return;\n\t\t\tswitch (tokens[0]) {\n\t\t\tcase 'users':\n\t\t\t\tconst usernames = tokens[1].split(',');\n\t\t\t\tconst count = parseInt(usernames.shift()!, 10);\n\t\t\t\tthis.props.room.setUsers(count, usernames);\n\t\t\t\treturn;\n\t\t\tcase 'join': case 'j': case 'J':\n\t\t\t\tthis.props.room.addUser(tokens[1]);\n\t\t\t\tbreak;\n\t\t\tcase 'leave': case 'l': case 'L':\n\t\t\t\tthis.props.room.removeUser(tokens[1]);\n\t\t\t\tbreak;\n\t\t\tcase 'name': case 'n': case 'N':\n\t\t\t\tthis.props.room.renameUser(tokens[1], tokens[2]);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (!this.props.noSubscription) this.log!.add(tokens);\n\t\t});\n\t\tthis.setControlsJSX(this.props.children);\n\t}\n\tcomponentWillUnmount() {\n\t\tif (this.subscription) this.subscription.unsubscribe();\n\t}\n\tshouldComponentUpdate(props: typeof ChatLog.prototype.props) {\n\t\tif (props.class !== this.props.class) {\n\t\t\tthis.base!.className = props.class;\n\t\t}\n\t\tif (props.left !== this.props.left) this.base!.style.left = `${props.left || 0}px`;\n\t\tif (props.top !== this.props.top) this.base!.style.top = `${props.top || 0}px`;\n\t\tthis.setControlsJSX(props.children);\n\t\tthis.updateScroll();\n\t\treturn false;\n\t}\n\tsetControlsJSX(jsx: preact.ComponentChildren | undefined) {\n\t\tconst children = this.base!.children;\n\t\tlet controlsElem = children[children.length - 1] as HTMLDivElement | undefined;\n\t\tif (controlsElem && controlsElem.className !== 'controls') controlsElem = undefined;\n\t\tif (!jsx) {\n\t\t\tif (!controlsElem) return;\n\t\t\tpreact.render(null, this.base!, controlsElem);\n\t\t\tthis.updateScroll();\n\t\t\treturn;\n\t\t}\n\t\tif (!controlsElem) {\n\t\t\tcontrolsElem = document.createElement('div');\n\t\t\tcontrolsElem.className = 'controls';\n\t\t\tthis.base!.appendChild(controlsElem);\n\t\t}\n\t\tpreact.render(<div class=\"controls\">{jsx}</div>, this.base!, controlsElem);\n\t\tthis.updateScroll();\n\t}\n\tupdateScroll() {\n\t\tif (this.log) {\n\t\t\tthis.log.updateScroll();\n\t\t} else if (this.props.room.battle) {\n\t\t\tthis.log = (this.props.room.battle as Battle).scene.log;\n\t\t\tthis.log.updateScroll();\n\t\t}\n\t}\n\trender() {\n\t\treturn <div class={this.props.class} role=\"log\" onClick={this.props.onClick} style={{\n\t\t\tleft: this.props.left || 0, top: this.props.top || 0,\n\t\t}}></div>;\n\t}\n}\n\nPS.roomTypes['chat'] = {\n\tModel: ChatRoom,\n\tComponent: ChatPanel,\n};\nPS.updateRoomTypes();\n"],"mappings":"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","ignoreList":[]}